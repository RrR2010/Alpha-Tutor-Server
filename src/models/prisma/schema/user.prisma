model User {
  id             String         @id @default(uuid())
  externalID     String         @unique
  name           String
  email          String         @unique
  status         UserStatus     @relation(fields: [statusId], references: [id])
  statusId       String
  dateRegistered DateTime       @default(now())
  roles          UserRole[]
  functions      UserFunction[]
}

model UserStatus {
  id          String  @id @default(uuid())
  name        String  @unique
  description String?
  users       User[]
}

model UserFunction {
  userId     String
  user       User     @relation(fields: [userId], references: [id])
  functionId String
  function   Function @relation(fields: [functionId], references: [id])
  assignedAt DateTime @default(now())
  active     Boolean  @default(true)

  @@id([userId, functionId])
}

model Role {
  id          String           @id @default(uuid())
  name        String           @unique
  description String?
  users       UserRole[]
  permissions RolePermission[]
}

model UserRole {
  userId       String
  user         User     @relation(fields: [userId], references: [id])
  roleId       String
  role         Role     @relation(fields: [roleId], references: [id])
  assignedAt   DateTime @default(now())
  assignedById String

  @@id([userId, roleId])
}

model Permission {
  id          String           @id @default(uuid())
  name        String           @unique
  description String?
  roles       RolePermission[]
}

model RolePermission {
  roleId       String
  role         Role       @relation(fields: [roleId], references: [id])
  permissionId String
  permission   Permission @relation(fields: [permissionId], references: [id])

  @@id([roleId, permissionId])
}
